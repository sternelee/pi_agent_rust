{
  "schema": "pi.qa.coverage_baseline.v1",
  "bead_id": "bd-1f42.8.1",
  "status": "complete_with_branch_metric_gap",
  "generated_at": "2026-02-13T04:18:00Z",
  "workspace": "/data/projects/pi_agent_rust",
  "collection": {
    "status": "complete_with_limits",
    "blockers": [
      "llvm-cov export crashes with SIGSEGV whenever branch summary mode is enabled in this environment.",
      "cargo llvm-cov invocations that include broad target sets (especially --all-targets and --lib --tests) can hit llvm-cov export SIGSEGV after successful test execution."
    ],
    "attempted_commands": [
      "cargo llvm-cov --workspace --all-targets --json --summary-only --branch --output-path target/coverage-summary-branch.json",
      "cargo llvm-cov report --json --summary-only --output-path target/coverage-summary.json",
      "CARGO_TARGET_DIR=target/coverage-fuchsia cargo llvm-cov --workspace --all-targets --json --summary-only --output-path target/coverage-baseline-raw.json --ignore-run-fail",
      "CARGO_TARGET_DIR=target/coverage-fuchsia cargo llvm-cov report --json --summary-only --output-path target/coverage-baseline-raw.json",
      "CARGO_TARGET_DIR=/data/projects/pi_agent_rust/target_cov_rusticpeak cargo llvm-cov --workspace --all-targets --json --summary-only --branch --output-path target/coverage-baseline-raw.json --ignore-run-fail",
      "CARGO_TARGET_DIR=/data/projects/pi_agent_rust/target_cov_rusticpeak cargo llvm-cov --workspace --lib --tests --json --summary-only --branch --output-path target/coverage-baseline-raw.json --ignore-run-fail",
      "CARGO_TARGET_DIR=/data/projects/pi_agent_rust/target_cov_lib_rusticpeak cargo llvm-cov --lib --json --summary-only --branch --output-path target/coverage-baseline-raw.json --ignore-run-fail",
      "CARGO_TARGET_DIR=/data/projects/pi_agent_rust/target_cov_lib_rusticpeak2 cargo llvm-cov --lib --json --summary-only --output-path target/coverage-baseline-raw.json --ignore-run-fail"
    ],
    "successful_command": "CARGO_TARGET_DIR=/data/projects/pi_agent_rust/target_cov_lib_rusticpeak2 cargo llvm-cov --lib --json --summary-only --output-path target/coverage-baseline-raw.json --ignore-run-fail",
    "recommended_next_command": "If branch coverage is mandatory, reproduce and isolate llvm-cov branch-summary crash with rustup nightly llvm-cov export, then retry cargo llvm-cov with --branch after toolchain fix.",
    "artifacts": {
      "coverage_json": "target/coverage-baseline-raw.json",
      "manual_export_json": "target/coverage-baseline-manual.json"
    }
  },
  "summary": {
    "line_pct": 78.5905941323898,
    "branch_pct": null,
    "function_pct": 77.3515784936968,
    "region_pct": 78.18185496378815,
    "line_count": 101745,
    "covered_line_count": 79962,
    "uncovered_line_count": 21783,
    "function_count": 9281,
    "covered_function_count": 7179,
    "uncovered_function_count": 2102,
    "branch_count": 0,
    "covered_branch_count": 0,
    "notes": "Line/function/region baselines are complete from llvm-cov JSON summary. Branch summary remains unavailable because branch-mode export crashes with SIGSEGV in this environment."
  },
  "critical_paths": [
    {
      "area": "agent_loop",
      "paths": [
        "src/agent.rs"
      ],
      "coverage": {
        "line_pct": 79.57336780866193,
        "branch_pct": null,
        "function_pct": 74.76340694006309,
        "line_count": 3094,
        "covered_line_count": 2462,
        "uncovered_line_count": 632,
        "function_count": 317,
        "covered_function_count": 237,
        "uncovered_function_count": 80,
        "branch_count": 0,
        "covered_branch_count": 0
      },
      "status": "baseline_captured_branch_unavailable"
    },
    {
      "area": "tools",
      "paths": [
        "src/tools.rs"
      ],
      "coverage": {
        "line_pct": 78.99076517150395,
        "branch_pct": null,
        "function_pct": 76.90417690417691,
        "line_count": 3032,
        "covered_line_count": 2395,
        "uncovered_line_count": 637,
        "function_count": 407,
        "covered_function_count": 313,
        "uncovered_function_count": 94,
        "branch_count": 0,
        "covered_branch_count": 0
      },
      "status": "baseline_captured_branch_unavailable"
    },
    {
      "area": "providers",
      "paths": [
        "src/provider.rs",
        "src/providers/*.rs",
        "src/providers/mod.rs"
      ],
      "coverage": {
        "line_pct": 86.34484299921779,
        "branch_pct": null,
        "function_pct": 83.311432325887,
        "line_count": 8949,
        "covered_line_count": 7727,
        "uncovered_line_count": 1222,
        "function_count": 761,
        "covered_function_count": 634,
        "uncovered_function_count": 127,
        "branch_count": 0,
        "covered_branch_count": 0
      },
      "status": "baseline_captured_branch_unavailable"
    },
    {
      "area": "session",
      "paths": [
        "src/session.rs"
      ],
      "coverage": {
        "line_pct": 80.49965301873699,
        "branch_pct": null,
        "function_pct": 77.87878787878788,
        "line_count": 2882,
        "covered_line_count": 2320,
        "uncovered_line_count": 562,
        "function_count": 330,
        "covered_function_count": 257,
        "uncovered_function_count": 73,
        "branch_count": 0,
        "covered_branch_count": 0
      },
      "status": "baseline_captured_branch_unavailable"
    },
    {
      "area": "extensions",
      "paths": [
        "src/extensions.rs",
        "src/extension_dispatcher.rs",
        "src/extensions_js.rs"
      ],
      "coverage": {
        "line_pct": 85.01170219495224,
        "branch_pct": null,
        "function_pct": 73.5281290885303,
        "line_count": 31618,
        "covered_line_count": 26879,
        "uncovered_line_count": 4739,
        "function_count": 2293,
        "covered_function_count": 1686,
        "uncovered_function_count": 607,
        "branch_count": 0,
        "covered_branch_count": 0
      },
      "status": "baseline_captured_branch_unavailable"
    }
  ],
  "critical_gap_matrix": [
    {
      "area": "agent_loop",
      "current": {
        "line_pct": 79.57336780866193,
        "function_pct": 74.76340694006309
      },
      "target": {
        "line_pct": 85.0,
        "function_pct": 80.0
      },
      "delta_to_target": {
        "line_pct": 5.42663219133807,
        "function_pct": 5.23659305993691
      },
      "blocker": "Abort/retry/interrupt control-flow paths remain under-covered; branch-depth signal is still blocked by llvm-cov branch-summary SIGSEGV.",
      "owning_bead_id": "bd-1f42.8.4.1"
    },
    {
      "area": "tools",
      "current": {
        "line_pct": 78.99076517150395,
        "function_pct": 76.90417690417691
      },
      "target": {
        "line_pct": 85.0,
        "function_pct": 82.0
      },
      "delta_to_target": {
        "line_pct": 6.00923482849605,
        "function_pct": 5.09582309582309
      },
      "blocker": "Tool error-path and threshold contract cases are still incomplete; branch-depth signal is blocked by llvm-cov branch-summary SIGSEGV.",
      "owning_bead_id": "bd-1f42.8.4.1"
    },
    {
      "area": "providers",
      "current": {
        "line_pct": 86.34484299921779,
        "function_pct": 83.311432325887
      },
      "target": {
        "line_pct": 90.0,
        "function_pct": 88.0
      },
      "delta_to_target": {
        "line_pct": 3.6551570007822096,
        "function_pct": 4.688567674113001
      },
      "blocker": "Provider routing and adapter coverage still misses key normalization/auth permutations across provider families.",
      "owning_bead_id": "bd-1f42.8.4.2"
    },
    {
      "area": "session",
      "current": {
        "line_pct": 80.49965301873699,
        "function_pct": 77.87878787878788
      },
      "target": {
        "line_pct": 85.0,
        "function_pct": 82.0
      },
      "delta_to_target": {
        "line_pct": 4.500346981263014,
        "function_pct": 4.121212121212125
      },
      "blocker": "Interruption/replay/index recovery paths remain shallow relative to target threshold depth.",
      "owning_bead_id": "bd-1f42.8.4.2"
    },
    {
      "area": "extensions",
      "current": {
        "line_pct": 85.01170219495224,
        "function_pct": 73.5281290885303
      },
      "target": {
        "line_pct": 88.0,
        "function_pct": 80.0
      },
      "delta_to_target": {
        "line_pct": 2.988297805047758,
        "function_pct": 6.471870911469704
      },
      "blocker": "Dispatcher/runtime/JS bridge has the largest remaining uncovered function surface and needs targeted non-mock expansion.",
      "owning_bead_id": "bd-1f42.8.4.3"
    }
  ],
  "risk_ranked_gap_backlog": [
    {
      "rank": 1,
      "gap": "Extensions critical-path function coverage deficit",
      "severity": "critical",
      "impact": "Largest uncovered surface in extension runtime increases risk of regressions in policy gating, host-call dispatch, and JS bridge behavior.",
      "reproducibility": "high",
      "target_test_type": "extension_fixtures+conformance+integration",
      "evidence": {
        "critical_path": "extensions",
        "uncovered_line_count": 4739,
        "uncovered_function_count": 607
      },
      "mapped_issue_id": "bd-1f42.8.4.3"
    },
    {
      "rank": 2,
      "gap": "Provider routing and adapter baseline gaps",
      "severity": "high",
      "impact": "Provider regressions can break model routing, auth handling, and tool-call normalization across integrations.",
      "reproducibility": "high",
      "target_test_type": "contract+conformance+smoke_e2e",
      "evidence": {
        "critical_path": "providers",
        "uncovered_line_count": 1222,
        "uncovered_function_count": 127
      },
      "mapped_issue_id": "bd-1f42.8.4.2"
    },
    {
      "rank": 3,
      "gap": "Agent loop orchestration uncovered branches of control flow",
      "severity": "high",
      "impact": "Missed abort/retry/interrupt paths can cause incorrect run termination and tool lifecycle inconsistencies.",
      "reproducibility": "medium",
      "target_test_type": "scenario_e2e+soak",
      "evidence": {
        "critical_path": "agent_loop",
        "uncovered_line_count": 632,
        "uncovered_function_count": 80
      },
      "mapped_issue_id": "bd-1f42.8.4.1"
    },
    {
      "rank": 4,
      "gap": "Tools execution/error-path threshold definition incomplete",
      "severity": "high",
      "impact": "Missing explicit non-mock thresholds weakens gate quality for file/shell/search tool reliability.",
      "reproducibility": "high",
      "target_test_type": "unit+integration_policy",
      "evidence": {
        "critical_path": "tools",
        "uncovered_line_count": 637,
        "uncovered_function_count": 94
      },
      "mapped_issue_id": "bd-1f42.8.4.1"
    },
    {
      "rank": 5,
      "gap": "Session persistence reliability coverage depth",
      "severity": "medium",
      "impact": "Uncovered persistence paths can produce replay/index drift under long-running or interrupted sessions.",
      "reproducibility": "medium",
      "target_test_type": "soak+recovery_e2e",
      "evidence": {
        "critical_path": "session",
        "uncovered_line_count": 562,
        "uncovered_function_count": 73
      },
      "mapped_issue_id": "bd-1f42.8.4.2"
    },
    {
      "rank": 6,
      "gap": "Branch coverage metric unavailable due llvm-cov SIGSEGV",
      "severity": "medium",
      "impact": "Branch-risk blind spots remain for release gating until branch summaries can be generated reliably.",
      "reproducibility": "high",
      "target_test_type": "coverage_infrastructure",
      "evidence": {
        "branch_count": 0,
        "failure_mode": "llvm-cov export SIGSEGV in branch-summary mode"
      },
      "mapped_issue_id": "bd-1f42.1.5"
    }
  ],
  "handoff": {
    "owner": "RusticPeak",
    "next_owner": "RusticPeak",
    "next_actions": [
      "Use uncovered line/function counts above to generate risk-ranked backlog entries in bd-1f42.1.4.",
      "If branch coverage remains required for release criteria, isolate and fix llvm-cov branch-summary SIGSEGV before re-running this artifact with branch metrics enabled.",
      "Expand session critical path in a follow-up pass to include session_index/session_sqlite if QA policy scope requires full persistence surface."
    ]
  }
}
