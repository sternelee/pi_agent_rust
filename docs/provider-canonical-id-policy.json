{
  "policy_version": "1.0",
  "bead_id": "bd-3uqg.1.3",
  "generated_at_utc": "2026-02-10T04:38:00Z",
  "depends_on": ["bd-3uqg.1.1", "bd-3uqg.1.2"],

  "normalization_algorithm": {
    "description": "Steps applied to user-supplied provider ID before lookup",
    "steps": [
      "1. Trim leading/trailing whitespace",
      "2. Convert to ASCII lowercase",
      "3. Replace underscores with hyphens",
      "4. Resolve alias to canonical ID via alias_map",
      "5. If canonical ID not found, use as-is (enables custom/extension providers)"
    ],
    "rationale": "Lowercase-hyphenated is the predominant convention in models.dev (87 IDs all lowercase-hyphenated). Underscore tolerance ensures users typing 'amazon_bedrock' still match."
  },

  "conflict_resolution_rules": [
    "1. models.dev ID is canonical when all sources agree (e.g., 'anthropic', 'openai', 'groq')",
    "2. When models.dev and opencode disagree, prefer models.dev ID as canonical; opencode ID becomes alias (e.g., canonical='google', alias='gemini')",
    "3. When pi_agent_rust uses a non-standard ID, add the upstream ID as primary canonical and keep the pi ID as alias with deprecation notice (e.g., canonical='fireworks-ai', alias='fireworks')",
    "4. Regional variants (e.g., 'alibaba-cn', 'moonshotai-cn') are distinct canonical IDs, not aliases",
    "5. Coding-plan variants (e.g., 'minimax-coding-plan') are distinct canonical IDs",
    "6. Extension-registered providers use their extension-declared ID as-is; no alias normalization"
  ],

  "deprecation_posture": {
    "policy": "Soft deprecation with warning, hard removal after 2 minor versions",
    "current_deprecations": [
      {
        "deprecated_id": "fireworks",
        "canonical_id": "fireworks-ai",
        "reason": "Pi used 'fireworks' but upstream canonical is 'fireworks-ai'",
        "action": "Accept 'fireworks' as alias, log deprecation warning, resolve to 'fireworks-ai'"
      },
      {
        "deprecated_id": "azure-openai",
        "canonical_id": "azure",
        "reason": "Pi used 'azure-openai' but models.dev canonical is 'azure'",
        "action": "Accept 'azure-openai' as alias, resolve to 'azure'"
      }
    ]
  },

  "canonical_id_map": {
    "_comment": "Complete mapping of 93 upstream IDs + pi-specific aliases. canonical_id is the authoritative ID.",
    "entries": [
      {"canonical_id": "302ai", "aliases": [], "source": "models.dev"},
      {"canonical_id": "abacus", "aliases": [], "source": "models.dev"},
      {"canonical_id": "aihubmix", "aliases": [], "source": "models.dev"},
      {"canonical_id": "alibaba", "aliases": ["dashscope", "qwen"], "source": "models.dev", "notes": "DashScope is Alibaba Cloud's API platform; Qwen is the model family"},
      {"canonical_id": "alibaba-cn", "aliases": [], "source": "models.dev"},
      {"canonical_id": "amazon-bedrock", "aliases": ["bedrock"], "source": "models.dev+opencode", "notes": "opencode uses 'bedrock'"},
      {"canonical_id": "anthropic", "aliases": [], "source": "all"},
      {"canonical_id": "azure", "aliases": ["azure-openai"], "source": "models.dev", "notes": "Pi historically used 'azure-openai'; models.dev canonical is 'azure'"},
      {"canonical_id": "azure-cognitive-services", "aliases": [], "source": "models.dev"},
      {"canonical_id": "bailing", "aliases": [], "source": "models.dev"},
      {"canonical_id": "baseten", "aliases": [], "source": "models.dev"},
      {"canonical_id": "berget", "aliases": [], "source": "models.dev"},
      {"canonical_id": "cerebras", "aliases": [], "source": "models.dev+opencode"},
      {"canonical_id": "chutes", "aliases": [], "source": "models.dev"},
      {"canonical_id": "cloudflare-ai-gateway", "aliases": [], "source": "models.dev+opencode"},
      {"canonical_id": "cloudflare-workers-ai", "aliases": [], "source": "models.dev+opencode"},
      {"canonical_id": "cohere", "aliases": [], "source": "models.dev"},
      {"canonical_id": "cortecs", "aliases": [], "source": "models.dev"},
      {"canonical_id": "deepinfra", "aliases": [], "source": "models.dev"},
      {"canonical_id": "deepseek", "aliases": [], "source": "models.dev"},
      {"canonical_id": "fastrouter", "aliases": [], "source": "models.dev"},
      {"canonical_id": "fireworks-ai", "aliases": ["fireworks"], "source": "models.dev", "notes": "Pi historically used 'fireworks'"},
      {"canonical_id": "firmware", "aliases": [], "source": "models.dev"},
      {"canonical_id": "friendli", "aliases": [], "source": "models.dev"},
      {"canonical_id": "github-copilot", "aliases": ["copilot"], "source": "models.dev+opencode", "notes": "opencode uses 'copilot'"},
      {"canonical_id": "github-copilot-enterprise", "aliases": [], "source": "opencode"},
      {"canonical_id": "github-models", "aliases": [], "source": "models.dev"},
      {"canonical_id": "gitlab", "aliases": [], "source": "models.dev+opencode"},
      {"canonical_id": "google", "aliases": ["gemini"], "source": "models.dev+opencode", "notes": "opencode uses 'gemini'; models.dev canonical is 'google'"},
      {"canonical_id": "google-vertex", "aliases": ["vertexai"], "source": "models.dev+opencode", "notes": "opencode uses 'vertexai'"},
      {"canonical_id": "google-vertex-anthropic", "aliases": [], "source": "models.dev"},
      {"canonical_id": "groq", "aliases": [], "source": "models.dev+opencode"},
      {"canonical_id": "helicone", "aliases": [], "source": "models.dev"},
      {"canonical_id": "huggingface", "aliases": [], "source": "models.dev"},
      {"canonical_id": "iflowcn", "aliases": [], "source": "models.dev"},
      {"canonical_id": "inception", "aliases": [], "source": "models.dev"},
      {"canonical_id": "inference", "aliases": [], "source": "models.dev"},
      {"canonical_id": "io-net", "aliases": [], "source": "models.dev"},
      {"canonical_id": "jiekou", "aliases": [], "source": "models.dev"},
      {"canonical_id": "kimi-for-coding", "aliases": [], "source": "models.dev", "notes": "Distinct from moonshotai/kimi alias; this is a coding-specific variant"},
      {"canonical_id": "llama", "aliases": [], "source": "models.dev"},
      {"canonical_id": "lmstudio", "aliases": [], "source": "models.dev+codex"},
      {"canonical_id": "lucidquery", "aliases": [], "source": "models.dev"},
      {"canonical_id": "minimax", "aliases": [], "source": "models.dev"},
      {"canonical_id": "minimax-cn", "aliases": [], "source": "models.dev"},
      {"canonical_id": "minimax-cn-coding-plan", "aliases": [], "source": "models.dev"},
      {"canonical_id": "minimax-coding-plan", "aliases": [], "source": "models.dev"},
      {"canonical_id": "mistral", "aliases": [], "source": "models.dev"},
      {"canonical_id": "moark", "aliases": [], "source": "models.dev"},
      {"canonical_id": "modelscope", "aliases": [], "source": "models.dev"},
      {"canonical_id": "moonshotai", "aliases": ["moonshot", "kimi"], "source": "models.dev", "notes": "MoonshotAI is the company; Kimi is the product name"},
      {"canonical_id": "moonshotai-cn", "aliases": [], "source": "models.dev"},
      {"canonical_id": "morph", "aliases": [], "source": "models.dev"},
      {"canonical_id": "nano-gpt", "aliases": [], "source": "models.dev"},
      {"canonical_id": "nebius", "aliases": [], "source": "models.dev"},
      {"canonical_id": "nova", "aliases": [], "source": "models.dev"},
      {"canonical_id": "novita-ai", "aliases": [], "source": "models.dev"},
      {"canonical_id": "nvidia", "aliases": [], "source": "models.dev"},
      {"canonical_id": "ollama", "aliases": [], "source": "codex"},
      {"canonical_id": "ollama-cloud", "aliases": [], "source": "models.dev"},
      {"canonical_id": "openai", "aliases": [], "source": "all"},
      {"canonical_id": "opencode", "aliases": [], "source": "models.dev+opencode", "notes": "Meta-routing provider in opencode; models.dev has as provider"},
      {"canonical_id": "openrouter", "aliases": [], "source": "models.dev+opencode"},
      {"canonical_id": "ovhcloud", "aliases": [], "source": "models.dev"},
      {"canonical_id": "perplexity", "aliases": [], "source": "models.dev"},
      {"canonical_id": "poe", "aliases": [], "source": "models.dev"},
      {"canonical_id": "privatemode-ai", "aliases": [], "source": "models.dev"},
      {"canonical_id": "requesty", "aliases": [], "source": "models.dev"},
      {"canonical_id": "sap-ai-core", "aliases": [], "source": "models.dev+opencode"},
      {"canonical_id": "scaleway", "aliases": [], "source": "models.dev"},
      {"canonical_id": "siliconflow", "aliases": [], "source": "models.dev"},
      {"canonical_id": "siliconflow-cn", "aliases": [], "source": "models.dev"},
      {"canonical_id": "submodel", "aliases": [], "source": "models.dev"},
      {"canonical_id": "synthetic", "aliases": [], "source": "models.dev"},
      {"canonical_id": "togetherai", "aliases": [], "source": "models.dev"},
      {"canonical_id": "upstage", "aliases": [], "source": "models.dev"},
      {"canonical_id": "v0", "aliases": [], "source": "models.dev"},
      {"canonical_id": "venice", "aliases": [], "source": "models.dev"},
      {"canonical_id": "vercel", "aliases": [], "source": "models.dev+opencode"},
      {"canonical_id": "vivgrid", "aliases": [], "source": "models.dev"},
      {"canonical_id": "vultr", "aliases": [], "source": "models.dev"},
      {"canonical_id": "wandb", "aliases": [], "source": "models.dev"},
      {"canonical_id": "xai", "aliases": [], "source": "models.dev+opencode"},
      {"canonical_id": "xiaomi", "aliases": [], "source": "models.dev"},
      {"canonical_id": "zai", "aliases": [], "source": "models.dev"},
      {"canonical_id": "zai-coding-plan", "aliases": [], "source": "models.dev"},
      {"canonical_id": "zenmux", "aliases": [], "source": "models.dev+opencode"},
      {"canonical_id": "zhipuai", "aliases": [], "source": "models.dev"},
      {"canonical_id": "zhipuai-coding-plan", "aliases": [], "source": "models.dev"}
    ]
  },

  "alias_lookup_table": {
    "_comment": "Flat alias->canonical lookup for implementation. Includes all aliases from canonical_id_map.",
    "azure-openai": "azure",
    "bedrock": "amazon-bedrock",
    "copilot": "github-copilot",
    "dashscope": "alibaba",
    "fireworks": "fireworks-ai",
    "gemini": "google",
    "kimi": "moonshotai",
    "moonshot": "moonshotai",
    "qwen": "alibaba",
    "vertexai": "google-vertex"
  },

  "pi_migration_actions": [
    {
      "current_pi_id": "azure-openai",
      "canonical_id": "azure",
      "files_to_update": ["src/providers/azure.rs (name() return)", "src/auth.rs (env_keys_for_provider match)", "src/providers/mod.rs (factory match)", "docs/providers.md"],
      "migration_type": "rename-with-alias",
      "breaking": false,
      "notes": "Keep 'azure-openai' as accepted alias"
    },
    {
      "current_pi_id": "fireworks",
      "canonical_id": "fireworks-ai",
      "files_to_update": ["src/models.rs (ad_hoc_provider_defaults match)", "src/auth.rs (env_keys_for_provider match)"],
      "migration_type": "rename-with-alias",
      "breaking": false,
      "notes": "Keep 'fireworks' as accepted alias"
    },
    {
      "current_pi_id": "alibaba",
      "canonical_id": "alibaba",
      "files_to_update": [],
      "migration_type": "none",
      "notes": "Already canonical; dashscope/qwen are correctly aliases"
    },
    {
      "current_pi_id": "moonshotai",
      "canonical_id": "moonshotai",
      "files_to_update": [],
      "migration_type": "none",
      "notes": "Already canonical; moonshot/kimi are correctly aliases"
    }
  ],

  "summary": {
    "total_canonical_ids": 88,
    "total_aliases": 10,
    "pi_ids_requiring_migration": 2,
    "breaking_changes": 0,
    "normalization": "trim + lowercase + underscore-to-hyphen + alias resolve"
  }
}
