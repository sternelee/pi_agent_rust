{
  "schema_version": "1.0.0",
  "program_issue_id": "bd-k5q5.7",
  "program_title": "Comprehensive Verification Program: unit tests, end-to-end scripts, and detailed diagnostics logging",
  "updated_at": "2026-02-08",
  "ci_policy": {
    "required_categories": [
      "unit_tests",
      "e2e_scripts",
      "evidence_logs"
    ],
    "min_classified_trace_coverage_pct": 20
  },
  "requirements": [
    {
      "id": "bd-k5q5.7",
      "title": "Comprehensive Verification Program: unit tests, end-to-end scripts, and detailed diagnostics logging",
      "acceptance_criteria": "Every major runtime surface and workflow is covered by deterministic unit tests and end-to-end scripts with structured logs, and evidence is consumable in CI and local workflows.",
      "unit_tests": [
        {
          "path": "tests/tools_conformance.rs",
          "justification": "Core host tools conformance and behavior checks."
        },
        {
          "path": "tests/ext_conformance_scenarios.rs",
          "justification": "Extension runtime scenario verification."
        },
        {
          "path": "tests/conformance_regression_gate.rs",
          "justification": "12 regression gate tests validating pass-rate thresholds, N/A limits, exception policy, and verdict generation."
        },
        {
          "path": "tests/e2e_agent_loop.rs",
          "justification": "Validates end-to-end agent loop behavior through realistic integration turns."
        },
        {
          "path": "tests/e2e_cli.rs",
          "justification": "Covers CLI-level interactive and non-interactive end-to-end execution flows."
        },
        {
          "path": "tests/e2e_cross_provider_parity.rs",
          "justification": "Checks cross-provider behavioral parity across the end-to-end integration surface."
        },
        {
          "path": "tests/e2e_message_session_control.rs",
          "justification": "Exercises session/message orchestration controls in end-to-end workflows."
        },
        {
          "path": "tests/e2e_provider_streaming.rs",
          "justification": "Verifies provider streaming behavior in full end-to-end execution paths."
        },
        {
          "path": "tests/e2e_rpc.rs",
          "justification": "Ensures RPC mode and transport semantics hold under end-to-end test conditions."
        },
        {
          "path": "tests/e2e_session_persistence.rs",
          "justification": "Validates end-to-end session persistence, resume, and state continuity behavior."
        },
        {
          "path": "tests/e2e_tools.rs",
          "justification": "Runs end-to-end tool invocation and result handling across representative tool paths."
        },
        {
          "path": "tests/e2e_tui.rs",
          "justification": "Covers terminal UI interaction loops and rendering-relevant end-to-end behavior."
        },
        {
          "path": "tests/e2e_workflow_preflight.rs",
          "justification": "Validates preflight workflow expectations before end-to-end runtime execution."
        },
        {
          "path": "tests/bench_schema.rs",
          "justification": "Schema-level bench artifact shape checks for deterministic diagnostics output."
        },
        {
          "path": "tests/capability_policy_model.rs",
          "justification": "Model-scoped capability policy resolution and precedence verification."
        },
        {
          "path": "tests/capability_policy_scoped.rs",
          "justification": "Scoped capability policy enforcement checks across nested policy contexts."
        },
        {
          "path": "tests/compaction.rs",
          "justification": "Session compaction correctness coverage for history truncation and continuity."
        },
        {
          "path": "tests/compaction_bug.rs",
          "justification": "Regression guard for previously observed compaction edge-case failures."
        },
        {
          "path": "tests/config_precedence.rs",
          "justification": "Configuration precedence behavior across defaults, env, project, and CLI layers."
        },
        {
          "path": "tests/error_types.rs",
          "justification": "Error typing and conversion-path behavior checks for stable diagnostics."
        },
        {
          "path": "tests/extension_scoring.rs",
          "justification": "Extension scoring logic and ranking stability under deterministic inputs."
        },
        {
          "path": "tests/mock_spec_schema.rs",
          "justification": "Mock spec schema invariants and validation behavior coverage."
        },
        {
          "path": "tests/mock_spec_validation.rs",
          "justification": "End-to-end mock spec validation and failure-path diagnostics checks."
        },
        {
          "path": "tests/model_selector_cycling.rs",
          "justification": "Model selector cycling behavior across available model inventories."
        },
        {
          "path": "tests/model_serialization.rs",
          "justification": "Model/message serialization round-trip correctness and edge-case handling."
        },
        {
          "path": "tests/perf_budgets.rs",
          "justification": "Performance budget policy enforcement for regression detection."
        },
        {
          "path": "tests/performance_comparison.rs",
          "justification": "Performance comparison harness behavior and report integrity checks."
        },
        {
          "path": "tests/scheduler_repro.rs",
          "justification": "Scheduler reproducer coverage for deterministic ordering and race regression guards."
        },
        {
          "path": "tests/security_budgets.rs",
          "justification": "Security budget threshold enforcement and evidence emission checks."
        },
        {
          "path": "tests/session_conformance.rs",
          "justification": "Session contract conformance for persistence, structure, and replay behavior."
        }
      ],
      "e2e_scripts": [
        {
          "path": "scripts/e2e/run_all.sh",
          "justification": "Unified end-to-end orchestration script."
        },
        {
          "path": "tests/run_e2e.sh",
          "justification": "Existing E2E invocation wrapper."
        }
      ],
      "evidence_logs": [
        {
          "path": "tests/e2e_results/**/*.jsonl",
          "generated_by_ci": true,
          "justification": "Structured E2E run logs and artifact index output."
        },
        {
          "path": "tests/ext_conformance/reports/**/*.json",
          "generated_by_ci": true,
          "justification": "Conformance and scenario reports published by CI."
        }
      ]
    },
    {
      "id": "bd-k5q5.7.1",
      "title": "Traceability matrix linking requirements to unit tests, e2e scripts, and evidence logs",
      "acceptance_criteria": "Matrix is committed, machine-readable, and used by CI checks to detect uncovered requirements.",
      "unit_tests": [
        {
          "path": "tests/conformance_fixtures.rs",
          "justification": "Fixture-driven tests validate matrix-linked behavior categories."
        }
      ],
      "e2e_scripts": [
        {
          "path": "scripts/e2e/run_all.sh",
          "justification": "Primary E2E entrypoint referenced by matrix entries."
        }
      ],
      "evidence_logs": [
        {
          "path": "tests/e2e_results/**/*.jsonl",
          "generated_by_ci": true,
          "justification": "CI artifacts proving runtime coverage."
        }
      ]
    },
    {
      "id": "bd-k5q5.7.2",
      "title": "Harness unit-test expansion for normalization, dispatch, and determinism",
      "acceptance_criteria": "Harness unit suite covers all known failure classes with detailed assertion messages and structured test logs.",
      "unit_tests": [
        {
          "path": "tests/event_loop_conformance.rs",
          "justification": "Deterministic event-loop behavior and ordering checks."
        },
        {
          "path": "tests/js_runtime_ordering.rs",
          "justification": "Dispatch ordering and deterministic runtime behavior."
        },
        {
          "path": "tests/ext_conformance_fixture_schema.rs",
          "justification": "Fixture normalization and schema-level validation."
        }
      ],
      "e2e_scripts": [
        {
          "path": "scripts/e2e/run_all.sh",
          "justification": "Runs harness-sensitive suites through reproducible command flow."
        }
      ],
      "evidence_logs": [
        {
          "path": "tests/ext_conformance/reports/**/*.jsonl",
          "generated_by_ci": true,
          "justification": "Harness scenario execution traces and diagnostics."
        }
      ]
    },
    {
      "id": "bd-k5q5.7.3",
      "title": "Runtime compatibility unit-test matrix for Node and Bun API surfaces",
      "acceptance_criteria": "API-level compatibility matrix is executable and produces per-API pass/fail output with rich diagnostics.",
      "unit_tests": [
        {
          "path": "tests/node_buffer_shim.rs",
          "justification": "Buffer API behavior coverage."
        },
        {
          "path": "tests/node_crypto_shim.rs",
          "justification": "Crypto API behavior coverage."
        },
        {
          "path": "tests/node_http_shim.rs",
          "justification": "HTTP shim behavior coverage."
        },
        {
          "path": "tests/npm_module_stubs.rs",
          "justification": "Module-level runtime compatibility checks."
        },
        {
          "path": "tests/ext_conformance_matrix.rs",
          "justification": "Compatibility matrix regression guard."
        },
        {
          "path": "tests/node_bun_api_matrix.rs",
          "justification": "151-test cross-module API surface coverage for Node/Bun shims."
        }
      ],
      "e2e_scripts": [
        {
          "path": "scripts/e2e/run_all.sh",
          "justification": "Executes compatibility-sensitive integration suites."
        }
      ],
      "evidence_logs": [
        {
          "path": "tests/ext_conformance/reports/**/*.json",
          "generated_by_ci": true,
          "justification": "Matrix and parity result payloads."
        }
      ]
    },
    {
      "id": "bd-k5q5.7.4",
      "title": "Capability policy unit tests for precedence, toggles, and scoped enforcement",
      "acceptance_criteria": "Policy unit tests prove no unauthorized path is silently allowed and logs contain actionable context.",
      "unit_tests": [
        {
          "path": "tests/extensions_policy_negative.rs",
          "justification": "Negative policy enforcement and denial-path coverage."
        },
        {
          "path": "tests/capability_denial_matrix.rs",
          "justification": "Capability-denial matrix checks for safety controls."
        },
        {
          "path": "tests/security_http_policy.rs",
          "justification": "HTTP policy-level guard coverage."
        }
      ],
      "e2e_scripts": [
        {
          "path": "scripts/e2e/run_all.sh",
          "justification": "End-to-end policy behavior under interactive and non-interactive flows."
        }
      ],
      "evidence_logs": [
        {
          "path": "tests/ext_conformance/reports/negative/**/*.json*",
          "generated_by_ci": true,
          "justification": "Policy negative test reports and event traces."
        }
      ]
    },
    {
      "id": "bd-k5q5.7.5",
      "title": "End-to-end extension corpus test suite across capability profiles",
      "acceptance_criteria": "E2E results include per-profile pass rates, blocked-operation summaries, detailed structured logs, and preflight-to-runtime consistency checks suitable for root-cause analysis.",
      "unit_tests": [
        {
          "path": "tests/extensions_registration.rs",
          "justification": "Registration and baseline runtime correctness before corpus E2E."
        },
        {
          "path": "tests/extensions_provider_streaming.rs",
          "justification": "Provider-path extension runtime behavior support."
        },
        {
          "path": "tests/extension_auto_repair_integration.rs",
          "justification": "Integration coverage for auto-repair behavior on real-world extension failure patterns."
        },
        {
          "path": "tests/extensions_auto_repair_unit.rs",
          "justification": "Pattern-level unit coverage for auto-repair decisions and fallback correctness."
        },
        {
          "path": "tests/security_fs_escape.rs",
          "justification": "Validates auto-repair fallback confinement so escape paths stay blocked outside extension scope."
        },
        {
          "path": "tests/e2e_auto_repair.rs",
          "justification": "Corpus-wide auto-repair end-to-end verification and report generation."
        },
        {
          "path": "tests/e2e_extension_registration.rs",
          "justification": "Verifies extension registration workflows in end-to-end runtime conditions."
        },
        {
          "path": "tests/e2e_library_integration.rs",
          "justification": "Covers end-to-end extension library integration behavior and compatibility."
        },
        {
          "path": "tests/e2e_live.rs",
          "justification": "Runs live end-to-end extension/provider flows for real integration behavior checks."
        },
        {
          "path": "tests/e2e_live_harness.rs",
          "justification": "Validates live harness wiring and execution contract for extension-centric E2E runs."
        },
        {
          "path": "tests/e2e_ts_extension_loading.rs",
          "justification": "Checks TypeScript extension loading behavior end-to-end across the runtime pipeline."
        }
      ],
      "e2e_scripts": [
        {
          "path": "scripts/e2e/run_all.sh",
          "justification": "Central script that runs extension-centric E2E suites."
        },
        {
          "path": "tests/run_e2e.sh",
          "justification": "Baseline shell wrapper for E2E orchestration."
        }
      ],
      "evidence_logs": [
        {
          "path": "tests/e2e_results/**/*.jsonl",
          "generated_by_ci": true,
          "justification": "Cross-profile E2E logs and artifact index entries."
        },
        {
          "path": "tests/ext_conformance/reports/**/*.jsonl",
          "generated_by_ci": true,
          "justification": "Extension corpus parity/scenario traces."
        }
      ]
    },
    {
      "id": "bd-k5q5.7.6",
      "title": "Fault-injection e2e suite for resilience and error clarity",
      "acceptance_criteria": "System degrades gracefully with clear user-facing diagnostics and logs sufficient for deterministic reproduction.",
      "unit_tests": [
        {
          "path": "tests/provider_error_paths.rs",
          "justification": "Provider fault and protocol edge-case coverage."
        },
        {
          "path": "tests/error_handling.rs",
          "justification": "Cross-provider error-path and messaging validation."
        },
        {
          "path": "tests/extensions_reliability.rs",
          "justification": "Extension-level resilience behavior checks."
        }
      ],
      "e2e_scripts": [
        {
          "path": "scripts/e2e/run_all.sh",
          "justification": "Fault-sensitive E2E suites execute via unified runner."
        }
      ],
      "evidence_logs": [
        {
          "path": "tests/e2e_results/**/*.jsonl",
          "generated_by_ci": true,
          "justification": "Failure logs and reproducibility artifacts."
        }
      ]
    },
    {
      "id": "bd-k5q5.7.7",
      "title": "Test logging contract and correlation model",
      "acceptance_criteria": "All test layers emit contract-compliant logs and tooling validates schema in CI.",
      "unit_tests": [
        {
          "path": "tests/tui_state.rs",
          "justification": "State tests exercise structured log + artifact emission helpers."
        },
        {
          "path": "tests/ext_conformance_artifacts.rs",
          "justification": "Artifact/report structure validation for conformance outputs."
        },
        {
          "path": "tests/extensions_repair_events.rs",
          "justification": "Auto-repair event schema, emission, and drain-path logging contract checks."
        }
      ],
      "e2e_scripts": [
        {
          "path": "scripts/e2e/run_all.sh",
          "justification": "Produces normalized multi-suite artifact outputs."
        }
      ],
      "evidence_logs": [
        {
          "path": "tests/e2e_results/**/*.jsonl",
          "generated_by_ci": true,
          "justification": "Structured E2E logs with correlation metadata."
        },
        {
          "path": "tests/ext_conformance/reports/**/*.jsonl",
          "generated_by_ci": true,
          "justification": "Conformance logging outputs for schema validation."
        }
      ]
    },
    {
      "id": "bd-k5q5.7.8",
      "title": "Unified test runner scripts for local and CI workflows",
      "acceptance_criteria": "Engineers can run verification quickly, and CI can reuse the exact same scripts for reproducibility.",
      "unit_tests": [
        {
          "path": "tests/bench_scenario_runner.rs",
          "justification": "Runner semantics and deterministic scenario orchestration checks."
        }
      ],
      "e2e_scripts": [
        {
          "path": "scripts/e2e/run_all.sh",
          "justification": "Canonical runner for local + CI workflows."
        },
        {
          "path": "tests/run_e2e.sh",
          "justification": "Legacy-compatible wrapper still used by contributors."
        }
      ],
      "evidence_logs": [
        {
          "path": "tests/e2e_results/**/*.json",
          "generated_by_ci": true,
          "justification": "Run metadata summaries and artifact manifests."
        }
      ]
    },
    {
      "id": "bd-k5q5.7.9",
      "title": "Evidence diff and triage tooling for failed unit or e2e runs",
      "acceptance_criteria": "Failure triage time is reduced with actionable, ranked diagnostics and reproducible command snippets.",
      "unit_tests": [
        {
          "path": "tests/ext_conformance_diff.rs",
          "justification": "Differential evidence and regression triage baseline."
        },
        {
          "path": "tests/perf_comparison.rs",
          "justification": "Comparison tooling for regression diagnostics."
        }
      ],
      "e2e_scripts": [
        {
          "path": "scripts/e2e/run_all.sh",
          "justification": "Produces baseline and current artifacts consumed by diff workflows."
        }
      ],
      "evidence_logs": [
        {
          "path": "tests/ext_conformance/reports/parity/**/*.json*",
          "generated_by_ci": true,
          "justification": "Parity diff artifacts for triage."
        }
      ]
    },
    {
      "id": "bd-k5q5.7.10",
      "title": "Soak and longevity end-to-end verification",
      "acceptance_criteria": "Soak reports include memory, timing, and error-rate trends with structured logs and pass/fail thresholds.",
      "unit_tests": [
        {
          "path": "tests/extensions_stress.rs",
          "justification": "Stress-path checks for prolonged extension runtime behavior."
        },
        {
          "path": "tests/ext_memory_stress.rs",
          "justification": "Memory-focused longevity checks."
        }
      ],
      "e2e_scripts": [
        {
          "path": "scripts/e2e/run_all.sh",
          "justification": "Used as base orchestrator for long-running suites."
        },
        {
          "path": "scripts/bench_extension_workloads.sh",
          "justification": "Bench-oriented workload runs for sustained execution evidence."
        }
      ],
      "evidence_logs": [
        {
          "path": "tests/perf/reports/**/*.json*",
          "generated_by_ci": true,
          "justification": "Soak/perf artifacts and trend summaries."
        }
      ]
    },
    {
      "id": "bd-k5q5.7.11",
      "title": "User-focused verification reports and release-readiness summary",
      "acceptance_criteria": "Reports are generated automatically from test artifacts and directly answer whether users can safely run extensions in each profile.",
      "unit_tests": [
        {
          "path": "tests/conformance_report.rs",
          "justification": "Conformance reporting shape and output checks."
        },
        {
          "path": "tests/ext_conformance_artifacts.rs",
          "justification": "Artifact/report integrity validation."
        },
        {
          "path": "tests/release_readiness.rs",
          "justification": "Unified release-readiness report aggregating conformance, performance, security, provenance, and traceability evidence."
        },
        {
          "path": "tests/release_evidence_gate.rs",
          "justification": "Release gate validating evidence bundle completeness, schema, thresholds, and exception policy."
        }
      ],
      "e2e_scripts": [
        {
          "path": "scripts/e2e/run_all.sh",
          "justification": "Generates top-level artifacts consumed by release-readiness summaries."
        }
      ],
      "evidence_logs": [
        {
          "path": "tests/ext_conformance/reports/**/*.json",
          "generated_by_ci": true,
          "justification": "Machine-readable reporting artifacts for user-facing summaries."
        },
        {
          "path": "tests/e2e_results/**/*.json",
          "generated_by_ci": true,
          "justification": "Aggregated E2E run summaries for readiness output."
        }
      ]
    },
    {
      "id": "bd-k5q5.7.14",
      "title": "Golden-path first-time-user e2e suite (install -> configure -> run -> recover)",
      "acceptance_criteria": "Complete onboarding journey is proven end-to-end: version/help, config, doctor (all formats), policy escalation, fix-and-recheck, and full user journey simulation.",
      "unit_tests": [
        {
          "path": "tests/e2e_golden_path.rs",
          "justification": "25 golden-path E2E tests covering install, configure, run, policy, recover, and full journey phases."
        }
      ],
      "e2e_scripts": [
        {
          "path": "scripts/e2e/run_all.sh",
          "justification": "Unified E2E runner that includes golden-path suite."
        }
      ],
      "evidence_logs": [
        {
          "path": "tests/e2e_results/**/*.jsonl",
          "generated_by_ci": true,
          "justification": "Golden-path journey logs and artifact capture."
        }
      ]
    }
  ]
}
