{
  "schema": "pi.ext.legacy_fixtures.v1",
  "extension": {
    "id": "permission-gate",
    "source": {
      "commit": "df5b0f76c026b35fdd7f0fb78cb0dbaaf939c1b5",
      "path": "packages/coding-agent/examples/extensions/permission-gate.ts"
    },
    "checksum": {
      "sha256": "d3d73f1d4b2dcea877564979ab797e46a79192e1613121f647da839afbe0bea1"
    }
  },
  "legacy": {
    "pi_mono_head": "df5b0f76c026b35fdd7f0fb78cb0dbaaf939c1b5",
    "node_version": "v20.19.4",
    "npm_version": "9.2.0"
  },
  "capture": {
    "provider": "openai",
    "model": "gpt-4o-mini",
    "no_env": true
  },
  "scenarios": [
    {
      "id": "scn-permission-gate-001",
      "kind": "event",
      "summary": "Blocks dangerous bash in non-interactive mode (no UI confirmation possible)",
      "event_name": "tool_call",
      "tool_name": null,
      "command_name": null,
      "provider_id": null,
      "input": {
        "ctx": {
          "has_ui": false
        },
        "event": {
          "input": {
            "command": "rm -rf /tmp/boom"
          },
          "toolName": "bash"
        }
      },
      "setup": null,
      "steps": [],
      "expect": {
        "block": true,
        "reason_contains": [
          "Dangerous command blocked"
        ],
        "no_error": true
      },
      "outputs": {
        "stdout_normalized_jsonl": [
          "{\"cwd\":\"<PI_MONO_ROOT>\",\"id\":\"<UUID>\",\"timestamp\":\"<TIMESTAMP>\",\"type\":\"session\",\"version\":3}",
          "{\"type\":\"agent_start\"}",
          "{\"type\":\"turn_start\"}",
          "{\"message\":{\"content\":[{\"text\":\"Run scenario scn-permission-gate-001.\",\"type\":\"text\"}],\"role\":\"user\",\"timestamp\":0},\"type\":\"message_start\"}",
          "{\"message\":{\"content\":[{\"text\":\"Run scenario scn-permission-gate-001.\",\"type\":\"text\"}],\"role\":\"user\",\"timestamp\":0},\"type\":\"message_end\"}",
          "{\"message\":{\"api\":\"openai-responses\",\"content\":[],\"model\":\"gpt-4o-mini\",\"provider\":\"openai\",\"role\":\"assistant\",\"stopReason\":\"stop\",\"timestamp\":0,\"usage\":{\"cacheRead\":0,\"cacheWrite\":0,\"cost\":{\"cacheRead\":0,\"cacheWrite\":0,\"input\":0,\"output\":0,\"total\":0},\"input\":0,\"output\":0,\"totalTokens\":0}},\"type\":\"message_start\"}",
          "{\"assistantMessageEvent\":{\"contentIndex\":0,\"partial\":{\"api\":\"openai-responses\",\"content\":[{\"text\":\"Calling tool bash.\",\"textSignature\":\"msg_0\",\"type\":\"text\"}],\"model\":\"gpt-4o-mini\",\"provider\":\"openai\",\"role\":\"assistant\",\"stopReason\":\"stop\",\"timestamp\":0,\"usage\":{\"cacheRead\":0,\"cacheWrite\":0,\"cost\":{\"cacheRead\":0,\"cacheWrite\":0,\"input\":0,\"output\":0,\"total\":0},\"input\":0,\"output\":0,\"totalTokens\":0}},\"type\":\"text_start\"},\"message\":{\"api\":\"openai-responses\",\"content\":[{\"text\":\"Calling tool bash.\",\"textSignature\":\"msg_0\",\"type\":\"text\"}],\"model\":\"gpt-4o-mini\",\"provider\":\"openai\",\"role\":\"assistant\",\"stopReason\":\"stop\",\"timestamp\":0,\"usage\":{\"cacheRead\":0,\"cacheWrite\":0,\"cost\":{\"cacheRead\":0,\"cacheWrite\":0,\"input\":0,\"output\":0,\"total\":0},\"input\":0,\"output\":0,\"totalTokens\":0}},\"type\":\"message_update\"}",
          "{\"assistantMessageEvent\":{\"content\":\"Calling tool bash.\",\"contentIndex\":0,\"partial\":{\"api\":\"openai-responses\",\"content\":[{\"text\":\"Calling tool bash.\",\"textSignature\":\"msg_0\",\"type\":\"text\"},{\"arguments\":{},\"id\":\"call_1|fc_1\",\"name\":\"bash\",\"partialJson\":\"\",\"type\":\"toolCall\"}],\"model\":\"gpt-4o-mini\",\"provider\":\"openai\",\"role\":\"assistant\",\"stopReason\":\"stop\",\"timestamp\":0,\"usage\":{\"cacheRead\":0,\"cacheWrite\":0,\"cost\":{\"cacheRead\":0,\"cacheWrite\":0,\"input\":0,\"output\":0,\"total\":0},\"input\":0,\"output\":0,\"totalTokens\":0}},\"type\":\"text_end\"},\"message\":{\"api\":\"openai-responses\",\"content\":[{\"text\":\"Calling tool bash.\",\"textSignature\":\"msg_0\",\"type\":\"text\"},{\"arguments\":{},\"id\":\"call_1|fc_1\",\"name\":\"bash\",\"partialJson\":\"\",\"type\":\"toolCall\"}],\"model\":\"gpt-4o-mini\",\"provider\":\"openai\",\"role\":\"assistant\",\"stopReason\":\"stop\",\"timestamp\":0,\"usage\":{\"cacheRead\":0,\"cacheWrite\":0,\"cost\":{\"cacheRead\":0,\"cacheWrite\":0,\"input\":0,\"output\":0,\"total\":0},\"input\":0,\"output\":0,\"totalTokens\":0}},\"type\":\"message_update\"}",
          "{\"assistantMessageEvent\":{\"contentIndex\":1,\"partial\":{\"api\":\"openai-responses\",\"content\":[{\"text\":\"Calling tool bash.\",\"textSignature\":\"msg_0\",\"type\":\"text\"},{\"arguments\":{\"command\":\"rm -rf /tmp/boom\"},\"id\":\"call_1|fc_1\",\"name\":\"bash\",\"partialJson\":\"{\\\"command\\\":\\\"rm -rf /tmp/boom\\\"}\",\"type\":\"toolCall\"}],\"model\":\"gpt-4o-mini\",\"provider\":\"openai\",\"role\":\"assistant\",\"stopReason\":\"stop\",\"timestamp\":0,\"usage\":{\"cacheRead\":0,\"cacheWrite\":0,\"cost\":{\"cacheRead\":0,\"cacheWrite\":0,\"input\":0,\"output\":0,\"total\":0},\"input\":0,\"output\":0,\"totalTokens\":0}},\"type\":\"toolcall_start\"},\"message\":{\"api\":\"openai-responses\",\"content\":[{\"text\":\"Calling tool bash.\",\"textSignature\":\"msg_0\",\"type\":\"text\"},{\"arguments\":{\"command\":\"rm -rf /tmp/boom\"},\"id\":\"call_1|fc_1\",\"name\":\"bash\",\"partialJson\":\"{\\\"command\\\":\\\"rm -rf /tmp/boom\\\"}\",\"type\":\"toolCall\"}],\"model\":\"gpt-4o-mini\",\"provider\":\"openai\",\"role\":\"assistant\",\"stopReason\":\"stop\",\"timestamp\":0,\"usage\":{\"cacheRead\":0,\"cacheWrite\":0,\"cost\":{\"cacheRead\":0,\"cacheWrite\":0,\"input\":0,\"output\":0,\"total\":0},\"input\":0,\"output\":0,\"totalTokens\":0}},\"type\":\"message_update\"}",
          "{\"assistantMessageEvent\":{\"contentIndex\":1,\"partial\":{\"api\":\"openai-responses\",\"content\":[{\"text\":\"Calling tool bash.\",\"textSignature\":\"msg_0\",\"type\":\"text\"},{\"arguments\":{\"command\":\"rm -rf /tmp/boom\"},\"id\":\"call_1|fc_1\",\"name\":\"bash\",\"partialJson\":\"{\\\"command\\\":\\\"rm -rf /tmp/boom\\\"}\",\"type\":\"toolCall\"}],\"model\":\"gpt-4o-mini\",\"provider\":\"openai\",\"role\":\"assistant\",\"stopReason\":\"toolUse\",\"timestamp\":0,\"usage\":{\"cacheRead\":0,\"cacheWrite\":0,\"cost\":{\"cacheRead\":0,\"cacheWrite\":0,\"input\":0,\"output\":0,\"total\":0},\"input\":0,\"output\":0,\"totalTokens\":0}},\"toolCall\":{\"arguments\":{\"command\":\"rm -rf /tmp/boom\"},\"id\":\"call_1|fc_1\",\"name\":\"bash\",\"type\":\"toolCall\"},\"type\":\"toolcall_end\"},\"message\":{\"api\":\"openai-responses\",\"content\":[{\"text\":\"Calling tool bash.\",\"textSignature\":\"msg_0\",\"type\":\"text\"},{\"arguments\":{\"command\":\"rm -rf /tmp/boom\"},\"id\":\"call_1|fc_1\",\"name\":\"bash\",\"partialJson\":\"{\\\"command\\\":\\\"rm -rf /tmp/boom\\\"}\",\"type\":\"toolCall\"}],\"model\":\"gpt-4o-mini\",\"provider\":\"openai\",\"role\":\"assistant\",\"stopReason\":\"stop\",\"timestamp\":0,\"usage\":{\"cacheRead\":0,\"cacheWrite\":0,\"cost\":{\"cacheRead\":0,\"cacheWrite\":0,\"input\":0,\"output\":0,\"total\":0},\"input\":0,\"output\":0,\"totalTokens\":0}},\"type\":\"message_update\"}",
          "{\"message\":{\"api\":\"openai-responses\",\"content\":[{\"text\":\"Calling tool bash.\",\"textSignature\":\"msg_0\",\"type\":\"text\"},{\"arguments\":{\"command\":\"rm -rf /tmp/boom\"},\"id\":\"call_1|fc_1\",\"name\":\"bash\",\"partialJson\":\"{\\\"command\\\":\\\"rm -rf /tmp/boom\\\"}\",\"type\":\"toolCall\"}],\"model\":\"gpt-4o-mini\",\"provider\":\"openai\",\"role\":\"assistant\",\"stopReason\":\"toolUse\",\"timestamp\":0,\"usage\":{\"cacheRead\":0,\"cacheWrite\":0,\"cost\":{\"cacheRead\":0,\"cacheWrite\":0,\"input\":0,\"output\":0,\"total\":0},\"input\":0,\"output\":0,\"totalTokens\":0}},\"type\":\"message_end\"}",
          "{\"args\":{\"command\":\"rm -rf /tmp/boom\"},\"toolCallId\":\"call_1|fc_1\",\"toolName\":\"bash\",\"type\":\"tool_execution_start\"}",
          "{\"isError\":true,\"result\":{\"content\":[{\"text\":\"Dangerous command blocked (no UI for confirmation)\",\"type\":\"text\"}],\"details\":{}},\"toolCallId\":\"call_1|fc_1\",\"toolName\":\"bash\",\"type\":\"tool_execution_end\"}",
          "{\"message\":{\"content\":[{\"text\":\"Dangerous command blocked (no UI for confirmation)\",\"type\":\"text\"}],\"details\":{},\"isError\":true,\"role\":\"toolResult\",\"timestamp\":0,\"toolCallId\":\"call_1|fc_1\",\"toolName\":\"bash\"},\"type\":\"message_start\"}",
          "{\"message\":{\"content\":[{\"text\":\"Dangerous command blocked (no UI for confirmation)\",\"type\":\"text\"}],\"details\":{},\"isError\":true,\"role\":\"toolResult\",\"timestamp\":0,\"toolCallId\":\"call_1|fc_1\",\"toolName\":\"bash\"},\"type\":\"message_end\"}",
          "{\"message\":{\"api\":\"openai-responses\",\"content\":[{\"text\":\"Calling tool bash.\",\"textSignature\":\"msg_0\",\"type\":\"text\"},{\"arguments\":{\"command\":\"rm -rf /tmp/boom\"},\"id\":\"call_1|fc_1\",\"name\":\"bash\",\"partialJson\":\"{\\\"command\\\":\\\"rm -rf /tmp/boom\\\"}\",\"type\":\"toolCall\"}],\"model\":\"gpt-4o-mini\",\"provider\":\"openai\",\"role\":\"assistant\",\"stopReason\":\"toolUse\",\"timestamp\":0,\"usage\":{\"cacheRead\":0,\"cacheWrite\":0,\"cost\":{\"cacheRead\":0,\"cacheWrite\":0,\"input\":0,\"output\":0,\"total\":0},\"input\":0,\"output\":0,\"totalTokens\":0}},\"toolResults\":[{\"content\":[{\"text\":\"Dangerous command blocked (no UI for confirmation)\",\"type\":\"text\"}],\"details\":{},\"isError\":true,\"role\":\"toolResult\",\"timestamp\":0,\"toolCallId\":\"call_1|fc_1\",\"toolName\":\"bash\"}],\"type\":\"turn_end\"}",
          "{\"type\":\"turn_start\"}",
          "{\"message\":{\"api\":\"openai-responses\",\"content\":[],\"model\":\"gpt-4o-mini\",\"provider\":\"openai\",\"role\":\"assistant\",\"stopReason\":\"stop\",\"timestamp\":0,\"usage\":{\"cacheRead\":0,\"cacheWrite\":0,\"cost\":{\"cacheRead\":0,\"cacheWrite\":0,\"input\":0,\"output\":0,\"total\":0},\"input\":0,\"output\":0,\"totalTokens\":0}},\"type\":\"message_start\"}",
          "{\"assistantMessageEvent\":{\"contentIndex\":0,\"partial\":{\"api\":\"openai-responses\",\"content\":[{\"text\":\"ok\",\"textSignature\":\"msg_1\",\"type\":\"text\"}],\"model\":\"gpt-4o-mini\",\"provider\":\"openai\",\"role\":\"assistant\",\"stopReason\":\"stop\",\"timestamp\":0,\"usage\":{\"cacheRead\":0,\"cacheWrite\":0,\"cost\":{\"cacheRead\":0,\"cacheWrite\":0,\"input\":0,\"output\":0,\"total\":0},\"input\":0,\"output\":0,\"totalTokens\":0}},\"type\":\"text_start\"},\"message\":{\"api\":\"openai-responses\",\"content\":[{\"text\":\"ok\",\"textSignature\":\"msg_1\",\"type\":\"text\"}],\"model\":\"gpt-4o-mini\",\"provider\":\"openai\",\"role\":\"assistant\",\"stopReason\":\"stop\",\"timestamp\":0,\"usage\":{\"cacheRead\":0,\"cacheWrite\":0,\"cost\":{\"cacheRead\":0,\"cacheWrite\":0,\"input\":0,\"output\":0,\"total\":0},\"input\":0,\"output\":0,\"totalTokens\":0}},\"type\":\"message_update\"}",
          "{\"assistantMessageEvent\":{\"content\":\"ok\",\"contentIndex\":0,\"partial\":{\"api\":\"openai-responses\",\"content\":[{\"text\":\"ok\",\"textSignature\":\"msg_1\",\"type\":\"text\"}],\"model\":\"gpt-4o-mini\",\"provider\":\"openai\",\"role\":\"assistant\",\"stopReason\":\"stop\",\"timestamp\":0,\"usage\":{\"cacheRead\":0,\"cacheWrite\":0,\"cost\":{\"cacheRead\":0,\"cacheWrite\":0,\"input\":0,\"output\":0,\"total\":0},\"input\":0,\"output\":0,\"totalTokens\":0}},\"type\":\"text_end\"},\"message\":{\"api\":\"openai-responses\",\"content\":[{\"text\":\"ok\",\"textSignature\":\"msg_1\",\"type\":\"text\"}],\"model\":\"gpt-4o-mini\",\"provider\":\"openai\",\"role\":\"assistant\",\"stopReason\":\"stop\",\"timestamp\":0,\"usage\":{\"cacheRead\":0,\"cacheWrite\":0,\"cost\":{\"cacheRead\":0,\"cacheWrite\":0,\"input\":0,\"output\":0,\"total\":0},\"input\":0,\"output\":0,\"totalTokens\":0}},\"type\":\"message_update\"}",
          "{\"message\":{\"api\":\"openai-responses\",\"content\":[{\"text\":\"ok\",\"textSignature\":\"msg_1\",\"type\":\"text\"}],\"model\":\"gpt-4o-mini\",\"provider\":\"openai\",\"role\":\"assistant\",\"stopReason\":\"stop\",\"timestamp\":0,\"usage\":{\"cacheRead\":0,\"cacheWrite\":0,\"cost\":{\"cacheRead\":0,\"cacheWrite\":0,\"input\":0,\"output\":0,\"total\":0},\"input\":0,\"output\":0,\"totalTokens\":0}},\"type\":\"message_end\"}",
          "{\"message\":{\"api\":\"openai-responses\",\"content\":[{\"text\":\"ok\",\"textSignature\":\"msg_1\",\"type\":\"text\"}],\"model\":\"gpt-4o-mini\",\"provider\":\"openai\",\"role\":\"assistant\",\"stopReason\":\"stop\",\"timestamp\":0,\"usage\":{\"cacheRead\":0,\"cacheWrite\":0,\"cost\":{\"cacheRead\":0,\"cacheWrite\":0,\"input\":0,\"output\":0,\"total\":0},\"input\":0,\"output\":0,\"totalTokens\":0}},\"toolResults\":[],\"type\":\"turn_end\"}",
          "{\"messages\":[{\"content\":[{\"text\":\"Run scenario scn-permission-gate-001.\",\"type\":\"text\"}],\"role\":\"user\",\"timestamp\":0},{\"api\":\"openai-responses\",\"content\":[{\"text\":\"Calling tool bash.\",\"textSignature\":\"msg_0\",\"type\":\"text\"},{\"arguments\":{\"command\":\"rm -rf /tmp/boom\"},\"id\":\"call_1|fc_1\",\"name\":\"bash\",\"partialJson\":\"{\\\"command\\\":\\\"rm -rf /tmp/boom\\\"}\",\"type\":\"toolCall\"}],\"model\":\"gpt-4o-mini\",\"provider\":\"openai\",\"role\":\"assistant\",\"stopReason\":\"toolUse\",\"timestamp\":0,\"usage\":{\"cacheRead\":0,\"cacheWrite\":0,\"cost\":{\"cacheRead\":0,\"cacheWrite\":0,\"input\":0,\"output\":0,\"total\":0},\"input\":0,\"output\":0,\"totalTokens\":0}},{\"content\":[{\"text\":\"Dangerous command blocked (no UI for confirmation)\",\"type\":\"text\"}],\"details\":{},\"isError\":true,\"role\":\"toolResult\",\"timestamp\":0,\"toolCallId\":\"call_1|fc_1\",\"toolName\":\"bash\"},{\"api\":\"openai-responses\",\"content\":[{\"text\":\"ok\",\"textSignature\":\"msg_1\",\"type\":\"text\"}],\"model\":\"gpt-4o-mini\",\"provider\":\"openai\",\"role\":\"assistant\",\"stopReason\":\"stop\",\"timestamp\":0,\"usage\":{\"cacheRead\":0,\"cacheWrite\":0,\"cost\":{\"cacheRead\":0,\"cacheWrite\":0,\"input\":0,\"output\":0,\"total\":0},\"input\":0,\"output\":0,\"totalTokens\":0}}],\"type\":\"agent_end\"}"
        ],
        "meta_normalized": {
          "agent_dir": "target/legacy_capture/scn-permission-gate-001/<RUN_ID>/agent",
          "env": {
            "TZ": "UTC",
            "no_env": true
          },
          "exit": {
            "code": 0,
            "success": true
          },
          "extension_id": "permission-gate",
          "finished_at": "<TIMESTAMP>",
          "mock_openai": {
            "base_url": "http://127.0.0.1:<PORT>/v1"
          },
          "model": "gpt-4o-mini",
          "models_json": "target/legacy_capture/scn-permission-gate-001/<RUN_ID>/agent/models.json",
          "node_preload": null,
          "pi_mono": {
            "extension_path": "packages/coding-agent/examples/extensions/permission-gate.ts",
            "head": "df5b0f76c026b35fdd7f0fb78cb0dbaaf939c1b5",
            "manifest_checksum_sha256": "d3d73f1d4b2dcea877564979ab797e46a79192e1613121f647da839afbe0bea1",
            "manifest_commit": "df5b0f76c026b35fdd7f0fb78cb0dbaaf939c1b5",
            "root": "legacy_pi_mono_code/pi-mono"
          },
          "provider": "openai",
          "run_id": "<RUN_ID>",
          "scenario_event_name": "tool_call",
          "scenario_id": "scn-permission-gate-001",
          "scenario_kind": "event",
          "schema": "pi.legacy_capture.v1",
          "seed_session": null,
          "settings_json": "target/legacy_capture/scn-permission-gate-001/<RUN_ID>/agent/settings.json",
          "started_at": "<TIMESTAMP>"
        },
        "capture_log_normalized_jsonl": [
          "{\"correlation\":{\"extension_id\":\"permission-gate\",\"run_id\":\"<RUN_ID>\",\"scenario_id\":\"scn-permission-gate-001\"},\"data\":{\"extension_path\":\"packages/coding-agent/examples/extensions/permission-gate.ts\",\"legacy_head\":\"df5b0f76c026b35fdd7f0fb78cb0dbaaf939c1b5\",\"manifest_checksum_sha256\":\"d3d73f1d4b2dcea877564979ab797e46a79192e1613121f647da839afbe0bea1\",\"manifest_commit\":\"df5b0f76c026b35fdd7f0fb78cb0dbaaf939c1b5\",\"model\":\"gpt-4o-mini\",\"node_version\":\"v20.19.4\",\"npm_version\":\"9.2.0\",\"pi_mono_root\":\"legacy_pi_mono_code/pi-mono\",\"provider\":\"openai\",\"scenario_command_name\":null,\"scenario_event_name\":\"tool_call\",\"scenario_kind\":\"event\",\"scenario_provider_id\":null,\"scenario_tool_name\":null,\"started_at\":\"<TIMESTAMP>\"},\"event\":\"capture\",\"level\":\"info\",\"message\":\"capture.start\",\"schema\":\"pi.ext.log.v1\",\"source\":{\"component\":\"capture\",\"pid\":2999939},\"ts\":\"2026-02-03T12:36:31.057Z\"}",
          "{\"correlation\":{\"extension_id\":\"permission-gate\",\"run_id\":\"<RUN_ID>\",\"scenario_id\":\"scn-permission-gate-001\"},\"event\":\"capture\",\"level\":\"info\",\"message\":\"capture.finish\",\"schema\":\"pi.ext.log.v1\",\"source\":{\"component\":\"capture\",\"pid\":2999939},\"ts\":\"2026-02-03T12:36:33.440Z\"}"
        ]
      }
    },
    {
      "id": "scn-permission-gate-002",
      "kind": "event",
      "summary": "Prompts in UI and blocks when user selects No",
      "event_name": "tool_call",
      "tool_name": null,
      "command_name": null,
      "provider_id": null,
      "input": {
        "ctx": {
          "has_ui": true,
          "ui_responses": {
            "select": "No"
          }
        },
        "event": {
          "input": {
            "command": "sudo echo hi"
          },
          "toolName": "bash"
        }
      },
      "setup": null,
      "steps": [],
      "expect": {
        "block": true,
        "reason_contains": [
          "Blocked by user"
        ]
      },
      "outputs": {
        "stdout_normalized_jsonl": [
          "{\"command\":\"prompt\",\"id\":\"cmd-1\",\"success\":true,\"type\":\"response\"}",
          "{\"type\":\"agent_start\"}",
          "{\"type\":\"turn_start\"}",
          "{\"message\":{\"content\":[{\"text\":\"Run scenario.\",\"type\":\"text\"}],\"role\":\"user\",\"timestamp\":0},\"type\":\"message_start\"}",
          "{\"message\":{\"content\":[{\"text\":\"Run scenario.\",\"type\":\"text\"}],\"role\":\"user\",\"timestamp\":0},\"type\":\"message_end\"}",
          "{\"command\":\"get_state\",\"data\":{\"autoCompactionEnabled\":true,\"followUpMode\":\"one-at-a-time\",\"isCompacting\":false,\"isStreaming\":true,\"messageCount\":1,\"model\":{\"api\":\"openai-responses\",\"baseUrl\":\"http://127.0.0.1:<PORT>/v1\",\"contextWindow\":128000,\"cost\":{\"cacheRead\":0.08,\"cacheWrite\":0,\"input\":0.15,\"output\":0.6},\"id\":\"gpt-4o-mini\",\"input\":[\"text\",\"image\"],\"maxTokens\":16384,\"name\":\"GPT-4o mini\",\"provider\":\"openai\",\"reasoning\":false},\"pendingMessageCount\":0,\"sessionFile\":\"<PROJECT_ROOT>/target/legacy_capture/scn-permission-gate-002/<RUN_ID>/agent/sessions/--data-projects-pi_agent_rust-target-legacy_capture-scn-permission-gate-002-<RUN_ID>-workspace--/2026-02-03T12-36-35-468Z_3b3d3dd9-3e1b-44a3-90b7-bb471fef5eb8.jsonl\",\"sessionId\":\"<UUID>\",\"steeringMode\":\"one-at-a-time\",\"thinkingLevel\":\"off\"},\"id\":\"state-1\",\"success\":true,\"type\":\"response\"}",
          "{\"message\":{\"api\":\"openai-responses\",\"content\":[],\"model\":\"gpt-4o-mini\",\"provider\":\"openai\",\"role\":\"assistant\",\"stopReason\":\"stop\",\"timestamp\":0,\"usage\":{\"cacheRead\":0,\"cacheWrite\":0,\"cost\":{\"cacheRead\":0,\"cacheWrite\":0,\"input\":0,\"output\":0,\"total\":0},\"input\":0,\"output\":0,\"totalTokens\":0}},\"type\":\"message_start\"}",
          "{\"assistantMessageEvent\":{\"contentIndex\":0,\"partial\":{\"api\":\"openai-responses\",\"content\":[{\"text\":\"Calling tool bash.\",\"textSignature\":\"msg_0\",\"type\":\"text\"}],\"model\":\"gpt-4o-mini\",\"provider\":\"openai\",\"role\":\"assistant\",\"stopReason\":\"stop\",\"timestamp\":0,\"usage\":{\"cacheRead\":0,\"cacheWrite\":0,\"cost\":{\"cacheRead\":0,\"cacheWrite\":0,\"input\":0,\"output\":0,\"total\":0},\"input\":0,\"output\":0,\"totalTokens\":0}},\"type\":\"text_start\"},\"message\":{\"api\":\"openai-responses\",\"content\":[{\"text\":\"Calling tool bash.\",\"textSignature\":\"msg_0\",\"type\":\"text\"}],\"model\":\"gpt-4o-mini\",\"provider\":\"openai\",\"role\":\"assistant\",\"stopReason\":\"stop\",\"timestamp\":0,\"usage\":{\"cacheRead\":0,\"cacheWrite\":0,\"cost\":{\"cacheRead\":0,\"cacheWrite\":0,\"input\":0,\"output\":0,\"total\":0},\"input\":0,\"output\":0,\"totalTokens\":0}},\"type\":\"message_update\"}",
          "{\"assistantMessageEvent\":{\"content\":\"Calling tool bash.\",\"contentIndex\":0,\"partial\":{\"api\":\"openai-responses\",\"content\":[{\"text\":\"Calling tool bash.\",\"textSignature\":\"msg_0\",\"type\":\"text\"},{\"arguments\":{},\"id\":\"call_1|fc_1\",\"name\":\"bash\",\"partialJson\":\"\",\"type\":\"toolCall\"}],\"model\":\"gpt-4o-mini\",\"provider\":\"openai\",\"role\":\"assistant\",\"stopReason\":\"stop\",\"timestamp\":0,\"usage\":{\"cacheRead\":0,\"cacheWrite\":0,\"cost\":{\"cacheRead\":0,\"cacheWrite\":0,\"input\":0,\"output\":0,\"total\":0},\"input\":0,\"output\":0,\"totalTokens\":0}},\"type\":\"text_end\"},\"message\":{\"api\":\"openai-responses\",\"content\":[{\"text\":\"Calling tool bash.\",\"textSignature\":\"msg_0\",\"type\":\"text\"},{\"arguments\":{},\"id\":\"call_1|fc_1\",\"name\":\"bash\",\"partialJson\":\"\",\"type\":\"toolCall\"}],\"model\":\"gpt-4o-mini\",\"provider\":\"openai\",\"role\":\"assistant\",\"stopReason\":\"stop\",\"timestamp\":0,\"usage\":{\"cacheRead\":0,\"cacheWrite\":0,\"cost\":{\"cacheRead\":0,\"cacheWrite\":0,\"input\":0,\"output\":0,\"total\":0},\"input\":0,\"output\":0,\"totalTokens\":0}},\"type\":\"message_update\"}",
          "{\"assistantMessageEvent\":{\"contentIndex\":1,\"partial\":{\"api\":\"openai-responses\",\"content\":[{\"text\":\"Calling tool bash.\",\"textSignature\":\"msg_0\",\"type\":\"text\"},{\"arguments\":{\"command\":\"sudo echo hi\"},\"id\":\"call_1|fc_1\",\"name\":\"bash\",\"partialJson\":\"{\\\"command\\\":\\\"sudo echo hi\\\"}\",\"type\":\"toolCall\"}],\"model\":\"gpt-4o-mini\",\"provider\":\"openai\",\"role\":\"assistant\",\"stopReason\":\"stop\",\"timestamp\":0,\"usage\":{\"cacheRead\":0,\"cacheWrite\":0,\"cost\":{\"cacheRead\":0,\"cacheWrite\":0,\"input\":0,\"output\":0,\"total\":0},\"input\":0,\"output\":0,\"totalTokens\":0}},\"type\":\"toolcall_start\"},\"message\":{\"api\":\"openai-responses\",\"content\":[{\"text\":\"Calling tool bash.\",\"textSignature\":\"msg_0\",\"type\":\"text\"},{\"arguments\":{\"command\":\"sudo echo hi\"},\"id\":\"call_1|fc_1\",\"name\":\"bash\",\"partialJson\":\"{\\\"command\\\":\\\"sudo echo hi\\\"}\",\"type\":\"toolCall\"}],\"model\":\"gpt-4o-mini\",\"provider\":\"openai\",\"role\":\"assistant\",\"stopReason\":\"stop\",\"timestamp\":0,\"usage\":{\"cacheRead\":0,\"cacheWrite\":0,\"cost\":{\"cacheRead\":0,\"cacheWrite\":0,\"input\":0,\"output\":0,\"total\":0},\"input\":0,\"output\":0,\"totalTokens\":0}},\"type\":\"message_update\"}",
          "{\"assistantMessageEvent\":{\"contentIndex\":1,\"partial\":{\"api\":\"openai-responses\",\"content\":[{\"text\":\"Calling tool bash.\",\"textSignature\":\"msg_0\",\"type\":\"text\"},{\"arguments\":{\"command\":\"sudo echo hi\"},\"id\":\"call_1|fc_1\",\"name\":\"bash\",\"partialJson\":\"{\\\"command\\\":\\\"sudo echo hi\\\"}\",\"type\":\"toolCall\"}],\"model\":\"gpt-4o-mini\",\"provider\":\"openai\",\"role\":\"assistant\",\"stopReason\":\"toolUse\",\"timestamp\":0,\"usage\":{\"cacheRead\":0,\"cacheWrite\":0,\"cost\":{\"cacheRead\":0,\"cacheWrite\":0,\"input\":0,\"output\":0,\"total\":0},\"input\":0,\"output\":0,\"totalTokens\":0}},\"toolCall\":{\"arguments\":{\"command\":\"sudo echo hi\"},\"id\":\"call_1|fc_1\",\"name\":\"bash\",\"type\":\"toolCall\"},\"type\":\"toolcall_end\"},\"message\":{\"api\":\"openai-responses\",\"content\":[{\"text\":\"Calling tool bash.\",\"textSignature\":\"msg_0\",\"type\":\"text\"},{\"arguments\":{\"command\":\"sudo echo hi\"},\"id\":\"call_1|fc_1\",\"name\":\"bash\",\"partialJson\":\"{\\\"command\\\":\\\"sudo echo hi\\\"}\",\"type\":\"toolCall\"}],\"model\":\"gpt-4o-mini\",\"provider\":\"openai\",\"role\":\"assistant\",\"stopReason\":\"stop\",\"timestamp\":0,\"usage\":{\"cacheRead\":0,\"cacheWrite\":0,\"cost\":{\"cacheRead\":0,\"cacheWrite\":0,\"input\":0,\"output\":0,\"total\":0},\"input\":0,\"output\":0,\"totalTokens\":0}},\"type\":\"message_update\"}",
          "{\"id\":\"<UUID>\",\"method\":\"select\",\"options\":[\"Yes\",\"No\"],\"title\":\"⚠️ Dangerous command:\\n\\n  sudo echo hi\\n\\nAllow?\",\"type\":\"extension_ui_request\"}",
          "{\"message\":{\"api\":\"openai-responses\",\"content\":[{\"text\":\"Calling tool bash.\",\"textSignature\":\"msg_0\",\"type\":\"text\"},{\"arguments\":{\"command\":\"sudo echo hi\"},\"id\":\"call_1|fc_1\",\"name\":\"bash\",\"partialJson\":\"{\\\"command\\\":\\\"sudo echo hi\\\"}\",\"type\":\"toolCall\"}],\"model\":\"gpt-4o-mini\",\"provider\":\"openai\",\"role\":\"assistant\",\"stopReason\":\"toolUse\",\"timestamp\":0,\"usage\":{\"cacheRead\":0,\"cacheWrite\":0,\"cost\":{\"cacheRead\":0,\"cacheWrite\":0,\"input\":0,\"output\":0,\"total\":0},\"input\":0,\"output\":0,\"totalTokens\":0}},\"type\":\"message_end\"}",
          "{\"args\":{\"command\":\"sudo echo hi\"},\"toolCallId\":\"call_1|fc_1\",\"toolName\":\"bash\",\"type\":\"tool_execution_start\"}",
          "{\"command\":\"get_state\",\"data\":{\"autoCompactionEnabled\":true,\"followUpMode\":\"one-at-a-time\",\"isCompacting\":false,\"isStreaming\":true,\"messageCount\":2,\"model\":{\"api\":\"openai-responses\",\"baseUrl\":\"http://127.0.0.1:<PORT>/v1\",\"contextWindow\":128000,\"cost\":{\"cacheRead\":0.08,\"cacheWrite\":0,\"input\":0.15,\"output\":0.6},\"id\":\"gpt-4o-mini\",\"input\":[\"text\",\"image\"],\"maxTokens\":16384,\"name\":\"GPT-4o mini\",\"provider\":\"openai\",\"reasoning\":false},\"pendingMessageCount\":0,\"sessionFile\":\"<PROJECT_ROOT>/target/legacy_capture/scn-permission-gate-002/<RUN_ID>/agent/sessions/--data-projects-pi_agent_rust-target-legacy_capture-scn-permission-gate-002-<RUN_ID>-workspace--/2026-02-03T12-36-35-468Z_3b3d3dd9-3e1b-44a3-90b7-bb471fef5eb8.jsonl\",\"sessionId\":\"<UUID>\",\"steeringMode\":\"one-at-a-time\",\"thinkingLevel\":\"off\"},\"id\":\"state-2\",\"success\":true,\"type\":\"response\"}",
          "{\"isError\":true,\"result\":{\"content\":[{\"text\":\"Blocked by user\",\"type\":\"text\"}],\"details\":{}},\"toolCallId\":\"call_1|fc_1\",\"toolName\":\"bash\",\"type\":\"tool_execution_end\"}",
          "{\"message\":{\"content\":[{\"text\":\"Blocked by user\",\"type\":\"text\"}],\"details\":{},\"isError\":true,\"role\":\"toolResult\",\"timestamp\":0,\"toolCallId\":\"call_1|fc_1\",\"toolName\":\"bash\"},\"type\":\"message_start\"}",
          "{\"message\":{\"content\":[{\"text\":\"Blocked by user\",\"type\":\"text\"}],\"details\":{},\"isError\":true,\"role\":\"toolResult\",\"timestamp\":0,\"toolCallId\":\"call_1|fc_1\",\"toolName\":\"bash\"},\"type\":\"message_end\"}",
          "{\"message\":{\"api\":\"openai-responses\",\"content\":[{\"text\":\"Calling tool bash.\",\"textSignature\":\"msg_0\",\"type\":\"text\"},{\"arguments\":{\"command\":\"sudo echo hi\"},\"id\":\"call_1|fc_1\",\"name\":\"bash\",\"partialJson\":\"{\\\"command\\\":\\\"sudo echo hi\\\"}\",\"type\":\"toolCall\"}],\"model\":\"gpt-4o-mini\",\"provider\":\"openai\",\"role\":\"assistant\",\"stopReason\":\"toolUse\",\"timestamp\":0,\"usage\":{\"cacheRead\":0,\"cacheWrite\":0,\"cost\":{\"cacheRead\":0,\"cacheWrite\":0,\"input\":0,\"output\":0,\"total\":0},\"input\":0,\"output\":0,\"totalTokens\":0}},\"toolResults\":[{\"content\":[{\"text\":\"Blocked by user\",\"type\":\"text\"}],\"details\":{},\"isError\":true,\"role\":\"toolResult\",\"timestamp\":0,\"toolCallId\":\"call_1|fc_1\",\"toolName\":\"bash\"}],\"type\":\"turn_end\"}",
          "{\"type\":\"turn_start\"}",
          "{\"message\":{\"api\":\"openai-responses\",\"content\":[],\"model\":\"gpt-4o-mini\",\"provider\":\"openai\",\"role\":\"assistant\",\"stopReason\":\"stop\",\"timestamp\":0,\"usage\":{\"cacheRead\":0,\"cacheWrite\":0,\"cost\":{\"cacheRead\":0,\"cacheWrite\":0,\"input\":0,\"output\":0,\"total\":0},\"input\":0,\"output\":0,\"totalTokens\":0}},\"type\":\"message_start\"}",
          "{\"assistantMessageEvent\":{\"contentIndex\":0,\"partial\":{\"api\":\"openai-responses\",\"content\":[{\"text\":\"ok\",\"textSignature\":\"msg_1\",\"type\":\"text\"}],\"model\":\"gpt-4o-mini\",\"provider\":\"openai\",\"role\":\"assistant\",\"stopReason\":\"stop\",\"timestamp\":0,\"usage\":{\"cacheRead\":0,\"cacheWrite\":0,\"cost\":{\"cacheRead\":0,\"cacheWrite\":0,\"input\":0,\"output\":0,\"total\":0},\"input\":0,\"output\":0,\"totalTokens\":0}},\"type\":\"text_start\"},\"message\":{\"api\":\"openai-responses\",\"content\":[{\"text\":\"ok\",\"textSignature\":\"msg_1\",\"type\":\"text\"}],\"model\":\"gpt-4o-mini\",\"provider\":\"openai\",\"role\":\"assistant\",\"stopReason\":\"stop\",\"timestamp\":0,\"usage\":{\"cacheRead\":0,\"cacheWrite\":0,\"cost\":{\"cacheRead\":0,\"cacheWrite\":0,\"input\":0,\"output\":0,\"total\":0},\"input\":0,\"output\":0,\"totalTokens\":0}},\"type\":\"message_update\"}",
          "{\"assistantMessageEvent\":{\"content\":\"ok\",\"contentIndex\":0,\"partial\":{\"api\":\"openai-responses\",\"content\":[{\"text\":\"ok\",\"textSignature\":\"msg_1\",\"type\":\"text\"}],\"model\":\"gpt-4o-mini\",\"provider\":\"openai\",\"role\":\"assistant\",\"stopReason\":\"stop\",\"timestamp\":0,\"usage\":{\"cacheRead\":0,\"cacheWrite\":0,\"cost\":{\"cacheRead\":0,\"cacheWrite\":0,\"input\":0,\"output\":0,\"total\":0},\"input\":0,\"output\":0,\"totalTokens\":0}},\"type\":\"text_end\"},\"message\":{\"api\":\"openai-responses\",\"content\":[{\"text\":\"ok\",\"textSignature\":\"msg_1\",\"type\":\"text\"}],\"model\":\"gpt-4o-mini\",\"provider\":\"openai\",\"role\":\"assistant\",\"stopReason\":\"stop\",\"timestamp\":0,\"usage\":{\"cacheRead\":0,\"cacheWrite\":0,\"cost\":{\"cacheRead\":0,\"cacheWrite\":0,\"input\":0,\"output\":0,\"total\":0},\"input\":0,\"output\":0,\"totalTokens\":0}},\"type\":\"message_update\"}",
          "{\"message\":{\"api\":\"openai-responses\",\"content\":[{\"text\":\"ok\",\"textSignature\":\"msg_1\",\"type\":\"text\"}],\"model\":\"gpt-4o-mini\",\"provider\":\"openai\",\"role\":\"assistant\",\"stopReason\":\"stop\",\"timestamp\":0,\"usage\":{\"cacheRead\":0,\"cacheWrite\":0,\"cost\":{\"cacheRead\":0,\"cacheWrite\":0,\"input\":0,\"output\":0,\"total\":0},\"input\":0,\"output\":0,\"totalTokens\":0}},\"type\":\"message_end\"}",
          "{\"message\":{\"api\":\"openai-responses\",\"content\":[{\"text\":\"ok\",\"textSignature\":\"msg_1\",\"type\":\"text\"}],\"model\":\"gpt-4o-mini\",\"provider\":\"openai\",\"role\":\"assistant\",\"stopReason\":\"stop\",\"timestamp\":0,\"usage\":{\"cacheRead\":0,\"cacheWrite\":0,\"cost\":{\"cacheRead\":0,\"cacheWrite\":0,\"input\":0,\"output\":0,\"total\":0},\"input\":0,\"output\":0,\"totalTokens\":0}},\"toolResults\":[],\"type\":\"turn_end\"}",
          "{\"messages\":[{\"content\":[{\"text\":\"Run scenario.\",\"type\":\"text\"}],\"role\":\"user\",\"timestamp\":0},{\"api\":\"openai-responses\",\"content\":[{\"text\":\"Calling tool bash.\",\"textSignature\":\"msg_0\",\"type\":\"text\"},{\"arguments\":{\"command\":\"sudo echo hi\"},\"id\":\"call_1|fc_1\",\"name\":\"bash\",\"partialJson\":\"{\\\"command\\\":\\\"sudo echo hi\\\"}\",\"type\":\"toolCall\"}],\"model\":\"gpt-4o-mini\",\"provider\":\"openai\",\"role\":\"assistant\",\"stopReason\":\"toolUse\",\"timestamp\":0,\"usage\":{\"cacheRead\":0,\"cacheWrite\":0,\"cost\":{\"cacheRead\":0,\"cacheWrite\":0,\"input\":0,\"output\":0,\"total\":0},\"input\":0,\"output\":0,\"totalTokens\":0}},{\"content\":[{\"text\":\"Blocked by user\",\"type\":\"text\"}],\"details\":{},\"isError\":true,\"role\":\"toolResult\",\"timestamp\":0,\"toolCallId\":\"call_1|fc_1\",\"toolName\":\"bash\"},{\"api\":\"openai-responses\",\"content\":[{\"text\":\"ok\",\"textSignature\":\"msg_1\",\"type\":\"text\"}],\"model\":\"gpt-4o-mini\",\"provider\":\"openai\",\"role\":\"assistant\",\"stopReason\":\"stop\",\"timestamp\":0,\"usage\":{\"cacheRead\":0,\"cacheWrite\":0,\"cost\":{\"cacheRead\":0,\"cacheWrite\":0,\"input\":0,\"output\":0,\"total\":0},\"input\":0,\"output\":0,\"totalTokens\":0}}],\"type\":\"agent_end\"}",
          "{\"command\":\"get_state\",\"data\":{\"autoCompactionEnabled\":true,\"followUpMode\":\"one-at-a-time\",\"isCompacting\":false,\"isStreaming\":false,\"messageCount\":4,\"model\":{\"api\":\"openai-responses\",\"baseUrl\":\"http://127.0.0.1:<PORT>/v1\",\"contextWindow\":128000,\"cost\":{\"cacheRead\":0.08,\"cacheWrite\":0,\"input\":0.15,\"output\":0.6},\"id\":\"gpt-4o-mini\",\"input\":[\"text\",\"image\"],\"maxTokens\":16384,\"name\":\"GPT-4o mini\",\"provider\":\"openai\",\"reasoning\":false},\"pendingMessageCount\":0,\"sessionFile\":\"<PROJECT_ROOT>/target/legacy_capture/scn-permission-gate-002/<RUN_ID>/agent/sessions/--data-projects-pi_agent_rust-target-legacy_capture-scn-permission-gate-002-<RUN_ID>-workspace--/2026-02-03T12-36-35-468Z_3b3d3dd9-3e1b-44a3-90b7-bb471fef5eb8.jsonl\",\"sessionId\":\"<UUID>\",\"steeringMode\":\"one-at-a-time\",\"thinkingLevel\":\"off\"},\"id\":\"state-3\",\"success\":true,\"type\":\"response\"}"
        ],
        "meta_normalized": {
          "agent_dir": "target/legacy_capture/scn-permission-gate-002/<RUN_ID>/agent",
          "env": {
            "TZ": "UTC",
            "no_env": true
          },
          "exit": {
            "code": null,
            "success": false
          },
          "extension_id": "permission-gate",
          "finished_at": "<TIMESTAMP>",
          "mock_openai": {
            "base_url": "http://127.0.0.1:<PORT>/v1"
          },
          "model": "gpt-4o-mini",
          "models_json": "target/legacy_capture/scn-permission-gate-002/<RUN_ID>/agent/models.json",
          "node_preload": null,
          "pi_mono": {
            "extension_path": "packages/coding-agent/examples/extensions/permission-gate.ts",
            "head": "df5b0f76c026b35fdd7f0fb78cb0dbaaf939c1b5",
            "manifest_checksum_sha256": "d3d73f1d4b2dcea877564979ab797e46a79192e1613121f647da839afbe0bea1",
            "manifest_commit": "df5b0f76c026b35fdd7f0fb78cb0dbaaf939c1b5",
            "root": "legacy_pi_mono_code/pi-mono"
          },
          "provider": "openai",
          "run_id": "<RUN_ID>",
          "scenario_event_name": "tool_call",
          "scenario_id": "scn-permission-gate-002",
          "scenario_kind": "event",
          "schema": "pi.legacy_capture.v1",
          "seed_session": null,
          "settings_json": "target/legacy_capture/scn-permission-gate-002/<RUN_ID>/agent/settings.json",
          "started_at": "<TIMESTAMP>"
        },
        "capture_log_normalized_jsonl": [
          "{\"correlation\":{\"extension_id\":\"permission-gate\",\"run_id\":\"<RUN_ID>\",\"scenario_id\":\"scn-permission-gate-002\"},\"data\":{\"extension_path\":\"packages/coding-agent/examples/extensions/permission-gate.ts\",\"legacy_head\":\"df5b0f76c026b35fdd7f0fb78cb0dbaaf939c1b5\",\"manifest_checksum_sha256\":\"d3d73f1d4b2dcea877564979ab797e46a79192e1613121f647da839afbe0bea1\",\"manifest_commit\":\"df5b0f76c026b35fdd7f0fb78cb0dbaaf939c1b5\",\"model\":\"gpt-4o-mini\",\"node_version\":\"v20.19.4\",\"npm_version\":\"9.2.0\",\"pi_mono_root\":\"legacy_pi_mono_code/pi-mono\",\"provider\":\"openai\",\"scenario_command_name\":null,\"scenario_event_name\":\"tool_call\",\"scenario_kind\":\"event\",\"scenario_provider_id\":null,\"scenario_tool_name\":null,\"started_at\":\"<TIMESTAMP>\"},\"event\":\"capture\",\"level\":\"info\",\"message\":\"capture.start\",\"schema\":\"pi.ext.log.v1\",\"source\":{\"component\":\"capture\",\"pid\":2999939},\"ts\":\"2026-02-03T12:36:33.454Z\"}",
          "{\"correlation\":{\"extension_id\":\"permission-gate\",\"run_id\":\"<RUN_ID>\",\"scenario_id\":\"scn-permission-gate-002\"},\"event\":\"capture\",\"level\":\"info\",\"message\":\"capture.finish\",\"schema\":\"pi.ext.log.v1\",\"source\":{\"component\":\"capture\",\"pid\":2999939},\"ts\":\"2026-02-03T12:36:35.803Z\"}"
        ]
      }
    },
    {
      "id": "scn-permission-gate-neg-001",
      "kind": "event",
      "summary": "Negative: permission gate errors on malformed tool call event",
      "expect": {
        "is_error": true
      }
    }
  ]
}
